<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø§Ù„Ø±Ø­Ù„Ø§Øª 2025</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh; padding: 15px; overflow-x: hidden; margin: 0;
    }
    .container {
      position: relative; background: white; padding: 35px 25px;
      border-radius: 18px; box-shadow: 0 15px 40px rgba(0,0,0,0.2);
      text-align: center; width: 100%; max-width: 400px; margin: 0 auto;
    }
    h2 { margin-bottom: 20px; font-weight: 700; font-size: 22px; color: #333; }
    input, select {
      width: 100%; padding: 14px 18px; margin-bottom: 18px;
      border-radius: 10px; border: 2px solid #e0e0e0;
      font-size: 15px; text-align: center; font-family: 'Cairo', sans-serif; font-weight: 500;
    }
    input:focus, select:focus { outline: none; border-color: #2575fc; }
    button {
      background: linear-gradient(45deg, #6a11cb, #2575fc);
      color: white; border: none; padding: 14px 0; border-radius: 10px;
      font-size: 15px; cursor: pointer; font-weight: 600; width: 100%;
      font-family: 'Cairo', sans-serif;
    }

#phoneField {
  direction: ltr;
  text-align: center;
}

  </style>
</head>
<body>
<div class="container" id="mainContainer">
  <h2>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù„Ù„Ù…ÙˆØ¸Ù</h2>
  <input type="text" id="empId" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" oninput="validateNumber(this)">
  <button onclick="checkEmployee()">ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù…Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBNBrVpBK8p_WWNwNhSH-mZ6NXOyr2TLhI",
  authDomain: "voyage-touggourt-48755.firebaseapp.com",
  projectId: "voyage-touggourt-48755",
  storageBucket: "voyage-touggourt-48755.firebasestorage.app",
  messagingSenderId: "712694455348",
  appId: "1:712694455348:web:5b4e8df57347edf944fe61",
  measurementId: "G-TTJT4LQ65L"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const scriptURL = "https://script.google.com/macros/s/AKfycbwEcUGi1Th-MhzNx9HQHpb44Wpx7JQ-7pFackTr2sjwnfoRuz375m3xZ7dg5Tx1BblI7Q/exec";

  function validateNumber(input) {
    input.value = input.value.replace(/\D/g, '');
    if (input.value.length > 16) input.value = input.value.slice(0, 16);
  }

  async function checkEmployee() {
    const empId = document.getElementById("empId").value.trim();
    if (empId.length < 16) {
      Swal.fire({ icon: 'warning', title: 'Ø®Ø·Ø£', text: 'Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 16 Ø±Ù‚Ù…Ù‹Ø§' });
      return;
    }
    try {
      const docRef = db.collection("employees").doc(empId);
      const docSnap = await docRef.get();
      if (docSnap.exists) {
        const data = docSnap.data();
        Swal.fire({
          title: "âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­",
          html: `<b>Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨:</b> ${data.name}<br><b>Ø§Ù„Ø±ØªØ¨Ø©:</b> ${data.grade}<br><b>Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„:</b> ${data.place}`,
          icon: "success",
          confirmButtonText: "Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„"
        }).then(() => showForm(empId, data));
      } else {
        Swal.fire("âŒ Ø®Ø·Ø£", "Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
      }
    } catch (err) {
      Swal.fire("âŒ Ø®Ø·Ø£", "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
      console.error(err);
    }
  }

  function showForm(empId, data) {
    const container = document.getElementById("mainContainer");
    container.innerHTML = `
      <h2>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø±Ø­Ù„Ø§Øª 2025</h2>
      <input type="text" id="empIdField" value="${empId}" readonly>
      <input type="text" id="nameField" value="${data.name}" readonly>
      <input type="text" id="gradeField" value="${data.grade}" readonly>
      <input type="text" id="placeField" value="${data.place}" readonly>

      <select id="daairaField" onchange="updateBaladiya()">
        <option value="">Ø§Ø®ØªØ± Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø¹Ù…Ù„</option>
        <option value="ØªÙˆÙ‚Ø±Øª">ØªÙˆÙ‚Ø±Øª</option>
        <option value="ØªÙ…Ø§Ø³ÙŠÙ†">ØªÙ…Ø§Ø³ÙŠÙ†</option>
        <option value="Ø§Ù„Ù…Ù‚Ø§Ø±ÙŠÙ†">Ø§Ù„Ù…Ù‚Ø§Ø±ÙŠÙ†</option>
        <option value="Ø§Ù„Ø­Ø¬ÙŠØ±Ø©">Ø§Ù„Ø­Ø¬ÙŠØ±Ø©</option>
        <option value="Ø§Ù„Ø·ÙŠØ¨Ø§Øª">Ø§Ù„Ø·ÙŠØ¨Ø§Øª</option>
      </select>

      <select id="baladiyaField">
        <option value="">Ø§Ø®ØªØ± Ø¨Ù„Ø¯ÙŠØ© Ø§Ù„Ø¹Ù…Ù„</option>
      </select>

      <select id="tripField">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø±Ø­Ù„Ø©</option>
        <option value="Ù…ØµØ±">Ù…ØµØ±</option>
        <option value="Ù‚Ø§Ù„Ù…Ø©">Ù‚Ø§Ù„Ù…Ø©</option>
        <option value="Ø³Ø·ÙŠÙ">Ø³Ø·ÙŠÙ</option>
        <option value="ØªÙ…Ù†Ø±Ø§Ø³Øª">ØªÙ…Ù†Ø±Ø§Ø³Øª</option>
      </select>

      <input type="text" id="phoneField" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (10 Ø£Ø±Ù‚Ø§Ù…)" oninput="validatePhone(this)">
      <button id="submitBtn" onclick="submitForm()">ØªØ³Ø¬ÙŠÙ„</button>
    `;
    window.baladiyaMap = {
      "ØªÙˆÙ‚Ø±Øª": ["ØªÙˆÙ‚Ø±Øª", "Ø§Ù„Ù†Ø²Ù„Ø©", "ØªØ¨Ø³Ø¨Ø³Øª", "Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ø¨Ø¯ÙŠØ©"],
      "ØªÙ…Ø§Ø³ÙŠÙ†": ["ØªÙ…Ø§Ø³ÙŠÙ†", "Ø¨Ù„Ø¯Ø© Ø¹Ù…Ø±"],
      "Ø§Ù„Ù…Ù‚Ø§Ø±ÙŠÙ†": ["Ø§Ù„Ù…Ù‚Ø§Ø±ÙŠÙ†", "Ø³ÙŠØ¯ÙŠ Ø³Ù„ÙŠÙ…Ø§Ù†"],
      "Ø§Ù„Ø­Ø¬ÙŠØ±Ø©": ["Ø§Ù„Ø­Ø¬ÙŠØ±Ø©", "Ø§Ù„Ø¹Ø§Ù„ÙŠØ©"],
      "Ø§Ù„Ø·ÙŠØ¨Ø§Øª": ["Ø§Ù„Ø·ÙŠØ¨Ø§Øª", "Ø§Ù„Ù…Ù†Ù‚Ø±", "Ø§Ø¨Ù† Ù†Ø§ØµØ±"]
    };
  }

  function updateBaladiya() {
    const daaira = document.getElementById("daairaField").value;
    const baladiyaSelect = document.getElementById("baladiyaField");
    baladiyaSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø¨Ù„Ø¯ÙŠØ© Ø§Ù„Ø¹Ù…Ù„</option>';
    if (daaira && window.baladiyaMap[daaira]) {
      window.baladiyaMap[daaira].forEach(b => {
        const option = document.createElement("option");
        option.value = b; option.text = b;
        baladiyaSelect.add(option);
      });
    }
  }

  function validatePhone(input) {
  // Ù†Ø­Ø°Ù Ø£ÙŠ Ø±Ù…ÙˆØ² ØºÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
  let value = input.value.replace(/\D/g, "");

  // Ù†Ø­Ø¯Ù‘Ø¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø¨Ù€ 10 Ø£Ø±Ù‚Ø§Ù…
  if (value.length > 10) value = value.slice(0, 10);

  // Ù†Ø¶ÙŠÙ ØªÙ†Ø³ÙŠÙ‚: 00 00 00 00 00
  let formatted = "";
  for (let i = 0; i < value.length; i += 2) {
    if (i > 0) formatted += " ";
    formatted += value.substring(i, i + 2);
  }

  input.value = formatted;
}

 async function submitForm() {
  const submitBtn = document.getElementById("submitBtn");
  submitBtn.disabled = true;
  submitBtn.style.opacity = 0.6;

  const empId = document.getElementById("empIdField").value;
  const name = document.getElementById("nameField").value;
  const grade = document.getElementById("gradeField").value;
  const place = document.getElementById("placeField").value;
  const daaira = document.getElementById("daairaField").value.trim();
  const baladiya = document.getElementById("baladiyaField").value.trim();
  const trip = document.getElementById("tripField").value.trim();
  const phone = document.getElementById("phoneField").value.trim();

  if (phone.replace(/\s/g, '').length !== 10) {
    Swal.fire("ØªÙ†Ø¨ÙŠÙ‡", "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 10 Ø£Ø±Ù‚Ø§Ù…", "warning");
    submitBtn.disabled = false; submitBtn.style.opacity = 1; return;
  }
  if (!daaira || !baladiya || !trip) {
    Swal.fire("ØªÙ†Ø¨ÙŠÙ‡", "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©", "warning");
    submitBtn.disabled = false; submitBtn.style.opacity = 1; return;
  }

  // ğŸ”¹ Ø§Ø³ØªØ®Ø¯Ù… URLSearchParams Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† FormData
  const params = new URLSearchParams();
  params.append("empId", empId);
  params.append("name", name);
  params.append("grade", grade);
  params.append("place", place);
  params.append("daaira", daaira);
  params.append("baladiya", baladiya);
  params.append("trip", trip);
  params.append("phone", phone);

  Swal.fire({ title: 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

  try {
    const res = await fetch(scriptURL, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
      body: params.toString()
    });

    const data = await res.json();

    if (data.result === "success") {
      Swal.fire("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­", "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­", "success")
        .then(() => location.reload());
    } else if (data.result === "exists") {
  const d = data.data;
  Swal.fire({
    title: "âš ï¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§",
    html: `<b>Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ:</b> ${d.empId}<br>
           <b>Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨:</b> ${d.name}<br>
           <b>Ø§Ù„Ø±ØªØ¨Ø©:</b> ${d.grade}<br>
           <b>Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„:</b> ${d.place}<br>
           <b>Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©:</b> ${d.daaira}<br>
           <b>Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©:</b> ${d.baladiya}<br>
           <b>Ø§Ù„Ø±Ø­Ù„Ø©:</b> ${d.trip}<br>
           <b>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</b> ${d.phone}`,
    icon: "warning", confirmButtonText: "Ø­Ø³Ù†Ù‹Ø§"
  }).then(() => location.reload());

} else {
        Swal.fire("âŒ Ø®Ø·Ø£", "ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
        submitBtn.disabled = false;
        submitBtn.style.opacity = 1;
      }
    } catch (error) {
      Swal.fire("âŒ Ø®Ø·Ø£", "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„", "error");
      submitBtn.disabled = false;
      submitBtn.style.opacity = 1;
    }
  }


</script>
</body>
</html>



